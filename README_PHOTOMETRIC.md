# Photometric Stereo - フォトメトリックステレオ実験

3方向からの照明で撮影した画像から法線マップを計算し、表面の3D形状を推定する実験ツール。

## 原理

Woodhamのフォトメトリックステレオ法:
- 異なる方向から光を当てた3枚以上の画像を撮影
- 各画素の輝度値と光源方向から法線ベクトルを推定
- 式: `N * rho = L^(-1) * I`
  - N: 法線ベクトル
  - rho: アルベド（反射率）
  - L: 光源方向行列
  - I: 輝度値ベクトル

## 使い方

### 起動

```bash
python photometric_stereo.py
```

### 撮影手順

1. LED1を点灯（他は消灯）→「LED1撮影」ボタン
2. LED2を点灯（他は消灯）→「LED2撮影」ボタン
3. LED3を点灯（他は消灯）→「LED3撮影」ボタン
4. 「法線マップ計算」ボタンで計算

### 光源設定

各LEDの位置を方位角と仰角で指定:
- **方位角 (Azimuth)**: XY平面上の角度（0°=正面、反時計回り）
- **仰角 (Elevation)**: 水平面からの角度（45°が一般的）

デフォルト設定（120°間隔、仰角45°）:
- LED1: 方位角 0°, 仰角 45°
- LED2: 方位角 120°, 仰角 45°
- LED3: 方位角 240°, 仰角 45°

### 出力

`photometric_output/` フォルダに保存:
- `normal_map_*.png` - 法線マップ（RGB = XYZ方向）
- `albedo_*.png` - アルベド（反射率）マップ
- `led1_*.png`, `led2_*.png`, `led3_*.png` - 元画像
- `config_*.txt` - 撮影時の設定

## 注意事項

- 撮影時は1つのLEDのみ点灯し、他は消灯すること
- カメラと被写体の位置は固定すること
- 光源方向の設定は実際のLED配置に合わせて調整すること
- 露出は白飛びしない範囲で明るめに設定

## 参考

- [フォトメトリックステレオの解説記事](https://raccoon15.hatenablog.com/entry/2018/08/13/202523)
